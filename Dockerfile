FROM cartesi/image-emulator-base

LABEL maintainer="Carlo Fragni <carlo@cartesi.io>"

ENV BASE=/opt/machine-manager
ENV EMU_BASE=$BASE/machine-emulator

COPY requirements.txt $BASE/

# Install python and other dependencies
RUN \
    apt-get update && \
    apt-get install -y python3 python3-pip

RUN \
    pip3 install -r $BASE/requirements.txt

COPY . $BASE

#Making grpc/protobuf autogenerated python code files
RUN \
    cd $EMU_BASE/lib/grpc-interfaces && \
    bash generate_python_grpc_code.sh

#Changing directory to base
WORKDIR $BASE
CMD bash -c "python3 manager_server.py -a 0.0.0.0"
