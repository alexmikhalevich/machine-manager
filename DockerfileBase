FROM ubuntu:18.04

MAINTAINER Carlo Fragni <carlo@cartesi.io>

ENV DEBIAN_FRONTEND=noninteractive

ENV BASE=/opt/machine-manager
ENV EMU_BASE=$BASE/machine-emulator

RUN mkdir $BASE

# Install basic development tools
# ----------------------------------------------------
RUN \
    apt-get update && \
    apt-get install --no-install-recommends -y \
        build-essential wget git libreadline-dev libboost-container-dev \
        libboost-program-options-dev ca-certificates libtool automake \
        pkg-config patchelf

# Copy emulator directory and build it
# ----------------------------------------------------
COPY ./machine-emulator $EMU_BASE

#Building the emulator
SHELL ["/bin/bash", "-c"]
WORKDIR $EMU_BASE
# No need to make submodules as they were already downloaded when checking out machine-manager

RUN make distclean && \
    make downloads && \
    make dep && \
    make && \
    make install

